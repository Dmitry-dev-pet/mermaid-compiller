# Конституция mermaid-langgraph

## Цель
Этот проект создаёт сервис на базе LLM, который превращает запросы на естественном языке в корректные диаграммы Mermaid с автоматической валидацией и самовосстановлением, чтобы пользователи могли быстро и надёжно итеративно дорабатывать диаграммы.

## Принципы
- **Корректность прежде всего**: сгенерированные диаграммы должны быть синтаксически валидны по официальному движку Mermaid, когда это возможно.
- **Предсказуемые итерации**: каждая итерация (запрос → диаграмма) должна быть воспроизводимой и объяснимой из спецификаций, а не из разовых промптов.
- **Минимальная поверхность**: предпочитаем небольшой, чётко определённый HTTP API и один основной UI вместо множества слабо определённых точек входа.
- **Разделение ответственности**: оркестрация LLM, валидация Mermaid, хранилище и UI должны быть в отдельных модулях с ясными контрактами.
- **Безопасность и приватность**: никогда не логируем секреты, API-ключи или чувствительный пользовательский контент; логи должны быть безопасны для внутреннего шеринга.
- **Спецификация важнее интуиции**: изменения начинаются с обновления спецификации/плана, затем реализации; избегаем одноразовых обходных решений.

## Рекомендации по разработке
- **Язык и стек**: бэкенд на Python (LangGraph/LangChain для оркестрации), фронтенд на простом веб-стеке (может быть уточнён позже), валидация Mermaid через официальный JS-движок или тонкую обёртку.
- **Тестирование**: каждое изменение, влияющее на генерацию, валидацию или HTTP-контракты, по возможности должно сопровождаться автоматическими тестами.
- **API**: публичные HTTP-запросы и ответы должны быть задокументированы в спецификации фичи и плане до реализации.
- **Наблюдаемость**: логируем достаточно метаданных (промпт, количество попыток, валидно/не валидно, ошибки валидатора), чтобы отлаживать проблемы, не храня сырой чувствительный контент дольше необходимого.
- **Инкрементальная поставка**: сначала поставляем тонкий, но полностью рабочий MVP (один эндпоинт, базовый UI), а уже потом добавляем историю, аккаунты и продвинутый экспорт.
- **Обязательное использование `mcp context7`:** При написании или изменении кода для этого проекта ИИ-разработчик обязан использовать протокол `mcp context7` для получения информации о библиотеках и API. Это необходимо для гарантии того, что весь используемый код соответствует актуальным версиям и для предотвращения генерации устаревшего или нерабочего кода. При запросе информации о библиотеках (например, Mermaid.js) в промпте должен присутствовать маркер `use context7`.

## Не цели для v1
- Мультиарендная аутентификация и аккаунты пользователей.
- Долгосрочное хранение истории диаграмм сверх простого локального или файлового хранилища.
- Богатое совместное редактирование; v1 ориентирована на одного пользователя и одну сессию.

## Процесс принятия решений
В случае сомнений предпочитаем:
- более простую архитектуру вместо чрезмерно абстрактных решений;
- использование официального движка Mermaid как единственного источника истины по валидности;
- сначала обновление спецификации/плана, затем изменение кода.
