# PRD: mermaid-langgraph (v2.0 - React/Vite)

## 1. Обзор продукта

Веб‑инструмент (SPA) для создания и итеративного улучшения диаграмм Mermaid с помощью:
- естественно‑языковых промптов;
- существующего кода Mermaid (валидного или с ошибками).

Приложение работает в браузере (React 19), поддерживает подключение к OpenRouter или локальному `cliproxyapi`.

## 2. Цели продукта

- Упростить создание диаграмм Mermaid для разработчиков, аналитиков, техписов.
- Обеспечить безопасное использование LLM.
- Давать быструю визуальную обратную связь с поддержкой темной темы.
- Гарантировать корректный синтаксис через авто‑валидацию и AI-ассистента.
- Поддерживать мультиязычность (авто-определение языка пользователя).

## 3. Целевая аудитория и ключевые сценарии

**Сценарии:**
1. **S1 — Генерация с нуля по промпту**
   Пользователь вводит описание -> система анализирует язык и запрос -> генерирует диаграмму.
2. **S2 — Итеративное улучшение диаграммы**
   Чат-режим с сохранением контекста.
3. **S3 — Анализ кода**
   Пользователь нажимает "Analyze" -> ИИ объясняет структуру текущей диаграммы.
4. **S4 — Вставка и редактирование**
   Редактор с подсветкой синтаксиса и мгновенным превью.
5. **S5 — Автоматическое исправление**
   "Fix Syntax" отправляет ошибку в ИИ для генерации исправленного кода.

## 4. Область действия (Scope)

**Реализовано:**
- SPA‑клиент на React 19 + Vite.
- **Интеллектуальный чат:** (ChatColumn) с авто-определением языка и типа задачи.
- **Редактор кода:** (EditorColumn) с подсветкой синтаксиса (PrismJS) и темной темой (One Dark).
- **Превью:** (PreviewColumn) рендер SVG с поддержкой тем.
- **AI Интеграция:** Стратегии для OpenRouter и Cliproxy.
- **Документация:** Параллельная загрузка контекста.
- **UX:** Dark Mode, Auto-Connect, Resizable Layout.

**В планах:**
- Экспорт диаграмм (PNG/SVG).
- История версий.

## 5. Функциональные требования

### FR‑001 Генерация диаграммы по промпту
- Ввод промпта -> Анализ языка -> Запрос к LLM с контекстом -> Рендер.
- Ответ ИИ в чате очищается от кода диаграммы (код идет в редактор).

### FR‑002 Редактор кода
- Подсветка синтаксиса (PrismJS).
- Номера строк.
- Синхронизация с превью.
- Поддержка темной темы.

### FR‑003 Управление настройками
- Выбор провайдера, модели, языка (Auto/RU/EN), темы (Light/Dark).
- Настройки сохраняются в `localStorage`.
- Авто-подключение при старте.

### FR‑004 Валидация и Исправление
- Локальная валидация `mermaid.parse`.
- Функция `fixDiagram` для исправления ошибок через LLM.

### FR‑005 Анализ
- Функция `analyzeDiagram` для текстового объяснения диаграммы.

## 6. Нефункциональные требования

### NFR‑001 Производительность
- Использование `useLayoutEffect` для синхронизации тем.
- Асинхронная валидация для плавности ввода.

### NFR‑003 Архитектура
- **Framework:** React 19, TypeScript, Vite.
- **State:** Custom Hook `useDiagramStudio`.
- **Styling:** Tailwind CSS (Dark Mode).
- **Icons:** Lucide React.

## 7. Зависимости
- `react`, `react-dom`.
- `vite`.
- `mermaid`.
- `lucide-react`.
- `tailwindcss`.
- `react-simple-code-editor`, `prismjs`.
