# Задачи: Генератор Диаграмм Mermaid (React/Vite)

## 1. Инициализация Проекта
- [x] 1.1. Создать проект Vite + React + TypeScript.
- [x] 1.2. Настроить Tailwind CSS.
- [x] 1.3. Установить зависимости (`mermaid`, `lucide-react`, `express` и др.).
- [x] 1.4. Настроить конфигурацию Vite (proxy, alias).

## 2. Основные Компоненты UI
- [x] 2.1. **Header:** Меню настроек (URL прокси, ключ, выбор модели), статус соединения, переключение темы.
- [x] 2.2. **ChatColumn:** Список сообщений, поле ввода, выбор типа диаграммы.
- [x] 2.3. **EditorColumn:** Редактор кода (PrismJS), панель инструментов, выбор языка.
- [x] 2.4. **PreviewColumn:** Рендер SVG диаграммы с использованием `mermaid.render`.
- [x] 2.5. **Resizers:** Реализовать изменение ширины колонок.

## 3. Бизнес-логика (Services & Hooks)
- [x] 3.1. **mermaidService:**
    - [x] `validateMermaid`: Парсинг и возврат ошибок.
    - [x] `extractMermaidCode`: Регулярки для извлечения кода из Markdown.
    - [x] `initializeMermaid`: Глобальный конфиг (поддержка смены темы).
- [x] 3.2. **llmService:**
    - [x] Strategy Pattern (`OpenRouterStrategy`, `CliproxyStrategy`).
    - [x] `fetchModels`: Получение списка моделей.
    - [x] `generateDiagram`, `fixDiagram`, `chat`, `analyzeDiagram`.
    - [x] Мультиязычность (поддержка `language` параметра).
- [x] 3.3. **docsContextService:**
    - [x] Параллельный фетчинг документации.
- [x] 3.4. **useDiagramStudio (Hook):**
    - [x] Централизация состояния и логики.
    - [x] `handleSendMessage` (интеллектуальный чат).
    - [x] `handleAnalyze` (объяснение кода).
    - [x] `toggleTheme`, `setLanguage`.
    - [x] Безопасная инициализация (`safeParse` localStorage).

## 4. Интеграция и UX
- [x] 4.1. **Dark Mode:** Полная поддержка темной темы (UI + Editor + Mermaid).
- [x] 4.2. **Syntax Highlighting:** Подсветка синтаксиса Mermaid (PrismJS + кастомная грамматика).
- [x] 4.3. **Auto-Connect:** Автоматическое подключение при старте приложения.
- [x] 4.4. **Language Detection:** Авто-определение языка пользователя (RU/EN).

## 5. Доработка и Полировка (Future)
- [ ] 5.1. **Автоматический Fix Loop:** Реализовать опциональный автоматический цикл (до N попыток) при получении невалидного кода.
- [ ] 5.2. **Стилизация (Style Flow):** Добавить отдельный режим для стилизации диаграммы без изменения структуры.
- [ ] 5.3. **Тесты:** Добавить Unit-тесты для хуков и сервисов.
- [ ] 5.4. **Export:** Добавить экспорт диаграммы в PNG/SVG.

## 6. История Исправлений
- [x] 6.1. Исправлен "белый экран" (безопасный парсинг localStorage).
- [x] 6.2. Исправлен скачок курсора в редакторе (синхронное обновление state).
- [x] 6.3. Перенесена кнопка выбора языка в панель редактора.
- [x] 6.4. Исправлена синхронизация темы Mermaid при переключении.
